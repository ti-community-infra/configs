.global_definations:
  branch-protection_restrictions: &branch-protection_restrictions
    users:
      - ti-chi-bot
      - ti-chi-bot[bot]
prowjob_namespace: ${PROWJOB_NAMESPACE}
pod_namespace: ${TEST_PODS_NAMESPACE}

# more logs
log_level: debug

branch-protection:
  enforce_admins: true # rules apply to admins too!
  orgs:
    tikv:
      repos:
        community:
          branches:
            master:
              protect: true
              required_status_checks:
                contexts:
                  - "dco"
        pd:
          branches:
            master: &pd-release-branch-pt-with-tools-chunks
              protect: true
              required_status_checks:
                contexts:
                  - "dco"
                  - "tide"
                  - "statics"
                  - "chunks (1, Unit Test(1))"
                  - "chunks (2, Unit Test(2))"
                  - "chunks (3, Unit Test(3))"
                  - "chunks (4, Tests(1))"
                  - "chunks (5, Tests(2))"
                  - "chunks (6, Tools Test)"
                  - "chunks (7, Client Integration Test)"
                  - "chunks (8, TSO Integration Test)"
                  - "chunks (9, MicroService Integration(!TSO))"
                  - "chunks (10, MicroService Integration(TSO))"
                  - "tso-function-test"
                  - "idc-jenkins-ci/build"
                strict: false
              restrictions: *branch-protection_restrictions
            release-5.4:
              protect: true
              required_status_checks:
                contexts:
                  - "dco"
                  - "tide"
                  - "statics"
                  - "chunks (1)"
                  - "chunks (2)"
                  - "chunks (3)"
                  - "chunks (4)"
                  - "tso-function-test"
                  - "idc-jenkins-ci/build"
                strict: true
              restrictions: *branch-protection_restrictions
            release-6.0: &pd-release-branch-pt-with-10-chunks
              protect: true
              required_status_checks:
                contexts:
                  - "dco"
                  - "tide"
                  - "statics"
                  - "chunks (1)"
                  - "chunks (2)"
                  - "chunks (3)"
                  - "chunks (4)"
                  - "chunks (5)"
                  - "chunks (6)"
                  - "chunks (7)"
                  - "chunks (8)"
                  - "chunks (9)"
                  - "chunks (10)"
                  - "tso-function-test"
                  - "idc-jenkins-ci/build"
                strict: true
              restrictions: *branch-protection_restrictions                
            release-6.1: *pd-release-branch-pt-with-10-chunks
            release-6.2: *pd-release-branch-pt-with-10-chunks
            release-6.3: *pd-release-branch-pt-with-10-chunks
            release-6.4: *pd-release-branch-pt-with-10-chunks
            release-6.5: *pd-release-branch-pt-with-10-chunks
            release-6.6: *pd-release-branch-pt-with-10-chunks
            release-7.0: *pd-release-branch-pt-with-10-chunks
            release-7.1: *pd-release-branch-pt-with-10-chunks
            release-7.2: *pd-release-branch-pt-with-10-chunks
            release-7.3: &pd-release-branch-pt-with-13-chunks
              protect: true
              required_status_checks:
                contexts:
                  - "dco"
                  - "tide"
                  - "statics"
                  - "chunks (1)"
                  - "chunks (2)"
                  - "chunks (3)"
                  - "chunks (4)"
                  - "chunks (5)"
                  - "chunks (6)"
                  - "chunks (7)"
                  - "chunks (8)"
                  - "chunks (9)"
                  - "chunks (10)"
                  - "chunks (11)"
                  - "chunks (12)"
                  - "chunks (13)"
                  - "tso-function-test"
                  - "idc-jenkins-ci/build"
                strict: true
              restrictions: *branch-protection_restrictions
            release-7.4: *pd-release-branch-pt-with-13-chunks
            release-7.5: *pd-release-branch-pt-with-13-chunks
            release-8.0: *pd-release-branch-pt-with-13-chunks
            release-8.1: *pd-release-branch-pt-with-13-chunks
            release-8.2:
              protect: true
              required_status_checks:
                contexts:
                  - "dco"
                  - "tide"
                  - "statics"
                  - "chunks (1, Unit Test(1))"
                  - "chunks (2, Unit Test(2))"
                  - "chunks (3, Tools Test)"
                  - "chunks (4, Client Integration Test)"
                  - "chunks (5, TSO Integration Test)"
                  - "chunks (6, MicroService Integration Test)"
                  - "tso-function-test"
                  - "idc-jenkins-ci/build"
                strict: true
              restrictions: *branch-protection_restrictions
            release-8.3: *pd-release-branch-pt-with-tools-chunks
            # release-{{.ver}}: *pd-release-branch-pt-with-tools-chunks

        rocksdb:
          branches:
            6.29.tikv: &rocksdb-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                strict: true
              restrictions: *branch-protection_restrictions
            6.4.tikv: *rocksdb-branch-pt
            6.25.tikv: *rocksdb-branch-pt
            tikv-6.5: *rocksdb-branch-pt
        rust-rocksdb:
          branches:
            master:
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                  - "DCO"
                strict: true
              restrictions: *branch-protection_restrictions
            tikv-5.4: &rust-rocksdb-branch-pt-release
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                  - "DCO"
                strict: false
              restrictions: *branch-protection_restrictions
            tikv-6.1: *rust-rocksdb-branch-pt-release
            tikv-6.5: *rust-rocksdb-branch-pt-release
            tikv-7.1: *rust-rocksdb-branch-pt-release
            # tikv-{{.lts-major.minor}}: *rust-rocksdb-branch-pt-release

        raft-engine:
          branches:
            master: &raft-engine-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
            tikv-6.5: *raft-engine-branch-pt
        client-go:
          branches:
            master: &client-go-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
            tidb-6.1: *client-go-branch-pt
            tidb-6.5: *client-go-branch-pt
            tidb-7.1: *client-go-branch-pt
            tidb-7.5: *client-go-branch-pt
            tidb-cse-7.5: *client-go-branch-pt
            tidb-8.1: *client-go-branch-pt
        client-rust:
          branches:
            master:
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
        tikv:
          branches:
            master: &tikv-release-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "dco"
                  - "tide"
                  - "pull-unit-test"
                strict: false
              restrictions: *branch-protection_restrictions
            release-5.4: &tikv-old-release-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "dco"
                  - "idc-jenkins-ci/test"
                  - "tide"
                strict: true
              restrictions: *branch-protection_restrictions
            release-6.0: *tikv-old-release-branch-pt
            release-6.1: *tikv-old-release-branch-pt
            release-6.2: *tikv-old-release-branch-pt
            release-6.3: *tikv-old-release-branch-pt
            release-6.4: *tikv-old-release-branch-pt
            release-6.5: *tikv-old-release-branch-pt
            release-6.6: *tikv-old-release-branch-pt
            release-7.0: *tikv-old-release-branch-pt
            release-7.1: *tikv-old-release-branch-pt
            release-7.2: *tikv-old-release-branch-pt
            release-7.3: *tikv-old-release-branch-pt
            release-7.4: *tikv-old-release-branch-pt
            release-7.5: *tikv-old-release-branch-pt
            release-8.0: *tikv-old-release-branch-pt
            release-8.1: *tikv-old-release-branch-pt
            release-8.2: *tikv-release-branch-pt
            release-8.3: *tikv-release-branch-pt
            # release-{{.ver}}: *tikv-release-branch-pt

    pingcap:
      repos:
        community:
          branches:
            master:
              protect: true
              required_status_checks:
                contexts:
                  - "license/cla"
        monitoring:
          branches:
            master: &monitoring-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
            # release-{{.ver}}: *monitoring-branch-pt
            release-8.3: *monitoring-branch-pt
            release-8.2: *monitoring-branch-pt
            release-8.1: *monitoring-branch-pt
            release-8.0: *monitoring-branch-pt
            release-7.5: *monitoring-branch-pt
            release-7.4: *monitoring-branch-pt
            release-7.3: *monitoring-branch-pt
            release-7.2: *monitoring-branch-pt
            release-7.1: *monitoring-branch-pt
            release-7.0: *monitoring-branch-pt
            release-6.6: *monitoring-branch-pt
            release-6.5: *monitoring-branch-pt
            release-6.4: *monitoring-branch-pt
            release-6.3: *monitoring-branch-pt
            release-6.2: *monitoring-branch-pt
            release-6.1: *monitoring-branch-pt
        ng-monitoring:
          branches:
            main:
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
        tidb-dashboard:
          branches:
            master:
              enforce_admins: false
              protect: true
              required_status_checks:
                contexts:
                  - "Backend"
                  - "Frontend"
                  - "Backend - Unit"
                  - "license/cla"
                strict: true
              restrictions: *branch-protection_restrictions
            release:
              enforce_admins: false
              protect: true
              required_status_checks:
                contexts:
                  - "Backend"
                  - "Frontend"
                  - "Backend - Unit"
                  - "check_release_version"
                  - "license/cla"
                strict: true
              restrictions: *branch-protection_restrictions
        tidb-operator:
          branches:
            master:
              protect: true
              required_status_checks:
                contexts:
                  - "pull (verify)"
                  - "pull (build)"
                  - "pull (test)"
                  - "pull (e2e-examples)"
                  - "jenkins-ci / pull-e2e-kind"
                  - "jenkins-ci / pull-e2e-kind-serial"
                  - "jenkins-ci / pull-e2e-kind-basic"
                  - "jenkins-ci / pull-e2e-kind-br"
                  - "jenkins-ci / pull-e2e-kind-across-kubernetes"
                  - "license/cla"
                strict: true
              restrictions: *branch-protection_restrictions
            release-1.3:
              protect: true
              required_status_checks:
                contexts:
                  - "pull (verify)"
                  - "pull (build)"
                  - "pull (test)"
                  - "pull (e2e-examples)"
                  - "jenkins-ci / pull-e2e-kind"
                  - "jenkins-ci / pull-e2e-kind-serial"
                  - "jenkins-ci / pull-e2e-kind-basic"
                  - "jenkins-ci / pull-e2e-kind-br"
                  - "jenkins-ci / pull-e2e-kind-across-kubernetes"
                  - "license/cla"
                strict: true
              restrictions: *branch-protection_restrictions
            release-1.2:
              protect: true
              required_status_checks:
                contexts:
                  - "pull (verify)"
                  - "pull (build)"
                  - "pull (test)"
                  - "pull (e2e-examples)"
                  - "jenkins-ci / pull-e2e-kind"
                  - "jenkins-ci / pull-e2e-kind-serial"
                  - "jenkins-ci / pull-e2e-kind-basic"
                  - "jenkins-ci / pull-e2e-kind-br"
                  - "license/cla"
                strict: true
              restrictions: *branch-protection_restrictions
            release-1.1:
              protect: true
              required_status_checks:
                contexts:
                  - "pull (verify)"
                  - "pull (build)"
                  - "pull (test)"
                  - "pull (e2e-examples)"
                  - "jenkins-ci / pull-e2e-kind"
                  - "jenkins-ci / pull-e2e-kind-serial"
                  - "license/cla"
                strict: true
              restrictions: *branch-protection_restrictions
        tiup:
          branches:
            master:
              protect: true
              required_status_checks:
                contexts:
                  - "license/cla"
                strict: false
              restrictions: *branch-protection_restrictions
        tidb:
          branches:
            master:
              protect: true
              required_status_checks:
                contexts:
                  - "license/cla"
                  - "check-issue-triage-complete"
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
            release-5.4: &tidb-old-release-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "idc-jenkins-ci-tidb/build"
                  - "idc-jenkins-ci-tidb/check_dev"
                  - "idc-jenkins-ci-tidb/check_dev_2"
                  - "idc-jenkins-ci-tidb/unit-test"
                  - "idc-jenkins-ci-tidb/mysql-test"
                  - "license/cla"
                  - "tide"
                strict: true
              restrictions: *branch-protection_restrictions
            release-6.0: *tidb-old-release-branch-pt
            release-6.1: &tidb-release-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "license/cla"
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
            release-6.2: *tidb-release-branch-pt
            release-6.3: *tidb-release-branch-pt
            release-6.4: *tidb-release-branch-pt
            release-6.5: *tidb-release-branch-pt
            release-6.6: *tidb-release-branch-pt
            release-7.0: *tidb-release-branch-pt
            release-7.1: *tidb-release-branch-pt
            release-7.2: *tidb-release-branch-pt
            release-7.3: *tidb-release-branch-pt
            release-7.4: *tidb-release-branch-pt
            release-7.5: *tidb-release-branch-pt
            release-8.0: *tidb-release-branch-pt
            release-8.1: *tidb-release-branch-pt
            release-8.2: *tidb-release-branch-pt
            release-8.3: *tidb-release-branch-pt
            # release-{{.ver}}: *tidb-release-branch-pt

        docs:
          branches:
            master: &docs-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "tidb-check"
                  - "tidb-cloud-check"
                  - "license/cla"
                  - "pull-verify"
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
            release-5.1: &docs-old-release-branch-pt # need keep it before EOL(2024-06-24).
              protect: true
              required_status_checks:
                contexts:
                  - "pull"
                  - "license/cla"
                  - "pull-verify"
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
            release-5.2: *docs-old-release-branch-pt # need keep it before EOL(2024-08-27).
            release-5.3: *docs-old-release-branch-pt # need keep it before EOL(2024-11-30).
            release-5.4: *docs-branch-pt
            release-6.0: *docs-branch-pt
            release-6.1: *docs-branch-pt
            release-6.2: *docs-branch-pt
            release-6.3: *docs-branch-pt
            release-6.4: *docs-branch-pt
            release-6.5: *docs-branch-pt
            release-6.6: *docs-branch-pt
            release-7.0: *docs-branch-pt
            release-7.1: *docs-branch-pt
            release-7.2: *docs-branch-pt
            release-7.3: *docs-branch-pt
            release-7.4: *docs-branch-pt
            release-7.5: *docs-branch-pt
            release-8.0: *docs-branch-pt
            release-8.1: *docs-branch-pt
            release-8.2: *docs-branch-pt
            release-8.3: *docs-branch-pt
            # release-{{.ver}}: *docs-branch-pt

        docs-cn:
          branches:
            master: &docs-cn-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "pull"
                  - "license/cla"
                  - "pull-verify"
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
            release-5.1: *docs-cn-branch-pt # need keep it before EOL(2024-06-24).
            release-5.2: *docs-cn-branch-pt # need keep it before EOL(2024-08-27).
            release-5.3: *docs-cn-branch-pt # need keep it before EOL(2024-11-30).
            release-5.4: *docs-cn-branch-pt
            release-6.0: *docs-cn-branch-pt
            release-6.1: *docs-cn-branch-pt
            release-6.2: *docs-cn-branch-pt
            release-6.3: *docs-cn-branch-pt
            release-6.4: *docs-cn-branch-pt
            release-6.5: *docs-cn-branch-pt
            release-6.6: *docs-cn-branch-pt
            release-7.0: *docs-cn-branch-pt
            release-7.1: *docs-cn-branch-pt
            release-7.2: *docs-cn-branch-pt
            release-7.3: *docs-cn-branch-pt
            release-7.4: *docs-cn-branch-pt
            release-7.5: *docs-cn-branch-pt
            release-8.0: *docs-cn-branch-pt
            release-8.1: *docs-cn-branch-pt
            release-8.2: *docs-cn-branch-pt
            release-8.3: *docs-cn-branch-pt
            # release-{{.ver}}: *docs-cn-branch-pt

        docs-tidb-operator:
          branches:
            master: &docs-tidb-operator-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "check-file-encoding"
                  - "check-git-conflicts"
                  - "markdownlint"
                  - "verify-internal-links"
                  - "verify-internal-link-anchors"
                  - "check-control-characters"
                  - "check-unclosed-tags"
                  - "check-manual-line-breaks"
                  - "license/cla"
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
            release-1.0: *docs-tidb-operator-branch-pt
            release-1.1: *docs-tidb-operator-branch-pt
            release-1.2: *docs-tidb-operator-branch-pt
            release-1.3: *docs-tidb-operator-branch-pt
            release-1.4: *docs-tidb-operator-branch-pt
        tidb-tools:
          branches:
            master:
              protect: true
              required_status_checks:
                contexts:
                  - "license/cla"
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
        tiflow:
          branches:
            master:
              protect: true
              required_status_checks:
                contexts:
                  - "license/cla"
                  - "check-issue-triage-complete"
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
            release-5.4: &tiflow-release-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "license/cla"
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
            release-6.0:
              protect: true
              required_status_checks:
                contexts:
                  - "idc-jenkins-ci-ticdc/integration-test"
                  - "idc-jenkins-ci-ticdc/kafka-integration-test"
                  - "idc-jenkins-ci-ticdc/dm-integration-test"
                  - "idc-jenkins-ci-ticdc/dm-compatibility-test"
                  - "license/cla"
                  - "tide"
                strict: true
              restrictions: *branch-protection_restrictions
            release-6.1: *tiflow-release-branch-pt
            release-6.2:
              protect: true
              required_status_checks:
                contexts:
                  - "idc-jenkins-ci-ticdc/integration-test"
                  - "idc-jenkins-ci-ticdc/kafka-integration-test"
                  - "idc-jenkins-ci-ticdc/dm-integration-test"
                  - "idc-jenkins-ci-ticdc/dm-compatibility-test"
                  - "license/cla"
                  - "tide"
                strict: true
              restrictions: *branch-protection_restrictions
            release-6.3:
              protect: true
              required_status_checks:
                contexts:
                  - "idc-jenkins-ci-ticdc/integration-test"
                  - "idc-jenkins-ci-ticdc/kafka-integration-test"
                  - "idc-jenkins-ci-ticdc/dm-integration-test"
                  - "idc-jenkins-ci-ticdc/dm-compatibility-test"
                  - "license/cla"
                  - "tide"
                strict: true
              restrictions: *branch-protection_restrictions
            release-6.4:
              protect: true
              required_status_checks:
                contexts:
                  - "idc-jenkins-ci-ticdc/integration-test"
                  - "idc-jenkins-ci-ticdc/kafka-integration-test"
                  - "idc-jenkins-ci-ticdc/dm-integration-test"
                  - "idc-jenkins-ci-ticdc/dm-compatibility-test"
                  - "license/cla"
                  - "tide"
                strict: true
              restrictions: *branch-protection_restrictions
            release-6.5: *tiflow-release-branch-pt
            release-6.6:
              protect: true
              required_status_checks:
                contexts:
                  - "idc-jenkins-ci-ticdc/integration-test"
                  - "idc-jenkins-ci-ticdc/kafka-integration-test"
                  - "idc-jenkins-ci-ticdc/dm-integration-test"
                  - "idc-jenkins-ci-ticdc/dm-compatibility-test"
                  - "license/cla"
                  - "tide"
                strict: true
              restrictions: *branch-protection_restrictions
            release-7.0:
              protect: true
              required_status_checks:
                contexts:
                  - "idc-jenkins-ci-ticdc/integration-test"
                  - "idc-jenkins-ci-ticdc/kafka-integration-test"
                  - "idc-jenkins-ci-ticdc/dm-integration-test"
                  - "idc-jenkins-ci-ticdc/dm-compatibility-test"
                  - "license/cla"
                  - "tide"
                strict: true
              restrictions: *branch-protection_restrictions
            release-7.1: *tiflow-release-branch-pt
            release-7.2: *tiflow-release-branch-pt
            release-7.3: *tiflow-release-branch-pt
            release-7.4: *tiflow-release-branch-pt
            release-7.5: *tiflow-release-branch-pt
            release-8.0: *tiflow-release-branch-pt
            release-8.1: *tiflow-release-branch-pt
            release-8.2: *tiflow-release-branch-pt
            release-8.3: *tiflow-release-branch-pt
            # release-{{.ver}}: *tiflow-release-branch-pt

        tidb-binlog:
          branches:
            master: &tidb-binlog-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "idc-jenkins-ci-binlog/build"
                  - "idc-jenkins-ci-binlog/check"
                  - "idc-jenkins-ci-tidb-binlog/integration-test"
                  - "idc-jenkins-ci-tidb-binlog/unit-test"
                strict: true
              restrictions: *branch-protection_restrictions
            release-5.4: *tidb-binlog-branch-pt
            release-6.0: *tidb-binlog-branch-pt
            release-6.1: *tidb-binlog-branch-pt
            release-6.2: *tidb-binlog-branch-pt
            release-6.3: *tidb-binlog-branch-pt
            release-6.4: *tidb-binlog-branch-pt
            release-6.5: *tidb-binlog-branch-pt
            release-6.6: *tidb-binlog-branch-pt
            release-7.0: *tidb-binlog-branch-pt
            release-7.1: *tidb-binlog-branch-pt
            release-7.2: *tidb-binlog-branch-pt
            release-7.3: *tidb-binlog-branch-pt
            release-7.4: *tidb-binlog-branch-pt
            release-7.5: *tidb-binlog-branch-pt
            release-8.0: *tidb-binlog-branch-pt
            release-8.1: *tidb-binlog-branch-pt
            release-8.2: *tidb-binlog-branch-pt
            release-8.3: *tidb-binlog-branch-pt
            # release-{{.ver}}: *tidb-binlog-branch-pt

        tidb-engine-ext:
          branches:
            raftstore-proxy:
              protect: true
              required_status_checks:
                contexts: [tide]
                strict: false
              # restrictions: *branch-protection_restrictions
        tiflash:
          branches:
            master: &tiflash-master-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                  - "check-issue-triage-complete"
                  - "license/cla"
                strict: true
              restrictions: *branch-protection_restrictions
            release-8.2: &tiflash-release-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                  - "license/cla"
                strict: true
              restrictions: *branch-protection_restrictions
            release-8.3: *tiflash-release-branch-pt
            # release-{{.ver}}: *tiflash-release-branch-pt
            release-5.4: &tiflash-old-release-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                  - "idc-jenkins-ci-tiflash/unit-test"
                  - "idc-jenkins-ci-tiflash/integration-test"
                  - "idc-jenkins-ci-tiflash/build"
                  - "license/cla"
                strict: true
              restrictions: *branch-protection_restrictions
            release-6.0: *tiflash-old-release-branch-pt
            release-6.1: *tiflash-old-release-branch-pt
            release-6.2: *tiflash-old-release-branch-pt
            release-6.3: *tiflash-old-release-branch-pt
            release-6.4: *tiflash-old-release-branch-pt
            release-6.5: *tiflash-old-release-branch-pt
            release-6.6: *tiflash-old-release-branch-pt
            release-7.0: *tiflash-old-release-branch-pt
            release-7.1: *tiflash-old-release-branch-pt
            release-7.2: *tiflash-old-release-branch-pt
            release-7.3: *tiflash-old-release-branch-pt
            release-7.4: *tiflash-old-release-branch-pt
            release-7.5: *tiflash-old-release-branch-pt
            release-8.0: *tiflash-old-release-branch-pt
            release-8.1: *tiflash-old-release-branch-pt


        tispark:
          branches:
            master:
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                  - "license/cla"
                  - "build"
                  - "idc-jenkins-ci-tispark/integration-test"
                strict: true
              # restrictions: *branch-protection_restrictions
            release-2.3: &tispark-release-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                  - "license/cla"
                  - "idc-jenkins-ci-tispark/integration-test"
                strict: true
            release-2.4: *tispark-release-branch-pt
            release-2.5: *tispark-release-branch-pt
        tiunimanager:
          branches:
            main:
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                  - "license/cla"
                  - "jenkins-tiem/verify"
              restrictions: *branch-protection_restrictions
        tiunimanager-ui:
          branches:
            main:
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                  - "license/cla"
                  - "build"
                  - "lint"
              restrictions: *branch-protection_restrictions
        tiproxy:
          branches:
            main:
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
    pingcap-inc:
      repos:
        enterprise-extensions:
          branches:
            # only trunk and LTS branches
            master: &enterprise-extensions-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
            release-7.1: *enterprise-extensions-branch-pt
            release-7.5: *enterprise-extensions-branch-pt
            release-8.1: *enterprise-extensions-branch-pt
            release-8.2: *enterprise-extensions-branch-pt
            release-8.3: *enterprise-extensions-branch-pt
            # release-{{.ver}}: *enterprise-extensions-branch-pt # only LTS branches.

        enterprise-plugin:
          branches:
            # only trunk and LTS branches
            master: &enterprise-plugin-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                strict: false
              restrictions: *branch-protection_restrictions
            release-6.1: *enterprise-plugin-branch-pt
            release-6.5: *enterprise-plugin-branch-pt
            release-7.1: *enterprise-plugin-branch-pt
            release-7.5: *enterprise-plugin-branch-pt
            release-8.1: *enterprise-plugin-branch-pt
            release-8.2: *enterprise-plugin-branch-pt
            release-8.3: *enterprise-plugin-branch-pt
            # release-{{.ver}}: *enterprise-plugin-branch-pt # only LTS branches.

        tiflash-scripts:
          branches:
            master: &tiflash-scripts-branch-pt
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                  - "idc-jenkins-ci-tiflash-scripts/test"
                strict: true
              restrictions: *branch-protection_restrictions
            release-5.4: *tiflash-scripts-branch-pt
            release-6.0: *tiflash-scripts-branch-pt
            release-6.1: *tiflash-scripts-branch-pt
            release-6.2: *tiflash-scripts-branch-pt
            release-6.3: *tiflash-scripts-branch-pt
            release-6.4: *tiflash-scripts-branch-pt
            release-6.5: *tiflash-scripts-branch-pt
            release-6.6: *tiflash-scripts-branch-pt
            release-7.0: *tiflash-scripts-branch-pt
            release-7.1: *tiflash-scripts-branch-pt
            release-7.2: *tiflash-scripts-branch-pt
            release-7.3: *tiflash-scripts-branch-pt
            release-7.4: *tiflash-scripts-branch-pt
            release-7.5: *tiflash-scripts-branch-pt
            release-8.0: *tiflash-scripts-branch-pt
            release-8.1: *tiflash-scripts-branch-pt
            release-8.2: *tiflash-scripts-branch-pt
            release-8.3: *tiflash-scripts-branch-pt
            # release-{{.ver}}: *tiflash-scripts-branch-pt

    ti-community-infra:
      repos:
        tichi:
          branches:
            master:
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                  - "lint"
                strict: false
        configs:
          branches:
            main:
              protect: true
              required_status_checks:
                contexts:
                  - "tide"
                strict: false
        rfcs:
          branches:
            main:
              protect: true
              required_status_checks:
                contexts: []
                strict: false
in_repo_config:
  enabled:
    ti-community-infra/tichi: true
    ti-community-infra/test-prod: true

deck:
  external_agent_logs:
    - agent: jenkins
      url_template: "http://prow-jenkins-operator/job/{{.Spec.Job}}/{{.Status.JenkinsBuildID}}/consoleText"
  spyglass:
    lenses:
      - lens:
          name: metadata
        required_files:
          - started.json|finished.json
      - lens:
          config:
          name: buildlog
        required_files:
          - build-log.txt
      - lens:
          name: junit
        required_files:
          - ".*/junit.*\\\\.xml"
      - lens:
          name: podinfo
        required_files:
          - podinfo.json
  rerun_auth_configs:
    "*":
      github_team_slugs:
        - org: PingCAP-QE
          slug: ee

# for jenkins operator component.
jenkins_operators:
  - max_concurrency: 100
    max_goroutines: 100
    job_url_template:
      'https://do.pingcap.net/jenkins/job/{{replace "/" "/job/"
      .Spec.Job}}/{{.Status.JenkinsBuildID}}/display/redirect'

plank:
  job_url_prefix_config:
    "*": https://prow.tidb.net/view/
  report_templates:
    "*": >-
      [Full PR test
      history](https://prow.tidb.net/pr-history?org={{.Spec.Refs.Org}}&repo={{.Spec.Refs.Repo}}&pr={{with
      index .Spec.Refs.Pulls 0}}{{.Number}}{{end}}). [Your PR
      dashboard](https://prow.tidb.net/pr?query=is%3Apr%20state%3Aopen%20author%3A{{with
      index .Spec.Refs.Pulls 0}}{{.Author}}{{end}}).
  default_decoration_configs:
    "*":
      gcs_configuration:
        bucket: gs://prow-tidb-logs
        path_strategy: explicit
      gcs_credentials_secret: gcs-credentials
      utility_images:
        clonerefs: gcr.io/k8s-prow/clonerefs:v20230601-43eb1068e4
        entrypoint: gcr.io/k8s-prow/entrypoint:v20230601-43eb1068e4
        initupload: gcr.io/k8s-prow/initupload:v20230601-43eb1068e4
        sidecar: gcr.io/k8s-prow/sidecar:v20230601-43eb1068e4

tide:
  sync_period: 1m30s

  # prioritize_existing_batches:
  #   pingcap/tidb: true
  # Ordered list of sets of labels that would be prioritized before other PRs.
  priority:
    # The first entry has the highest priority.
    # PRs should match all labels contained in a set to be prioritized
    - labels: [Priority/P0]
    - labels: [Priority/P1]

  merge_method:
    pingcap-inc/enterprise-extensions: squash
    pingcap-inc/enterprise-plugin: squash
    pingcap-inc/tiflash-scripts: squash
    PingCAP-QE/artifacts: squash
    PingCAP-QE/automated-tests: squash
    PingCAP-QE/benchbot: squash
    PingCAP-QE/ci: squash
    PingCAP-QE/ee-apps: squash
    PingCAP-QE/ee-ops: squash
    PingCAP-QE/endless: squash
    PingCAP-QE/qa: squash
    PingCAP-QE/test-infra: squash
    PingCAP-QE/test-plan: squash
    PingCAP-QE/tidb-test: squash
    PingCAP-QE/workload: squash
    pingcap/community: squash
    pingcap/docs-cn: squash
    pingcap/docs-tidb-operator: squash
    pingcap/docs: squash
    pingcap/kvproto: squash
    pingcap/monitoring: squash
    pingcap/ng-monitoring: squash
    pingcap/tidb-binlog: squash
    pingcap/tidb-dashboard: squash
    pingcap/tidb-engine-ext: squash
    pingcap/tidb-operator: squash
    pingcap/tidb-tools: squash
    pingcap/tidb: squash
    pingcap/tiflash: squash
    pingcap/tiflow: squash
    pingcap/tiproxy: squash
    pingcap/tispark: squash
    pingcap/tiunimanager-ui: squash
    pingcap/tiunimanager: squash
    pingcap/tiup: squash
    ti-community-infra/configs: squash
    ti-community-infra/rfcs: squash
    ti-community-infra/test-prod: squash
    ti-community-infra/tichi: squash
    tikv/client-go: squash
    tikv/client-rust: squash
    tikv/community: squash
    tikv/pd: squash
    tikv/raft-engine: squash
    tikv/rocksdb: squash
    tikv/rust-rocksdb: squash
    tikv/tikv: squash

  # Please reference the document about custom commit message template:
  # https://book.prow.tidb.net/#/en/components/tide?id=custom-commit-message-template
  merge_commit_template:
    ti-community-infra:
      title: >-
        {{ .ExtractContent
        "^(?P<content>.+?)(\\\\s+\\\\|(\\\\s+[-\\\\w]+=[-.\\\\w/]+)+)?$" .Title
        }} (#{{ .Number }})
      body: |
        {{- $body := print .Body -}}
        {{- $issueNumberLine := .ExtractContent "(?im)^Issue Number:.+" $body -}}
        {{- $numbers := .GitHub.NormalizeIssueNumbers $issueNumberLine -}}
        {{- if $numbers -}}
          {{- range $index, $number := $numbers -}}
            {{- if $index }}, {{ end -}}
            {{- .AssociatePrefix }} {{ .Org -}}/{{- .Repo -}}#{{- .Number -}}
          {{- end -}}
        {{- else -}}
          {{- " " -}}
        {{- end -}}
    tikv:
      title: "{{ .Title }} (#{{ .Number }})"
      body: |
        {{- $body := print .Body -}}

        {{- $numbers := .GitHub.NormalizeIssueNumbers $body -}}
        {{- if $numbers -}}
          {{- range $index, $number := $numbers -}}
            {{- if $index }}, {{ end -}}
            {{- .AssociatePrefix }} {{ .Org -}}/{{- .Repo -}}#{{- .Number -}}
          {{- end -}}
        {{- else -}}
          {{- " " -}}
        {{- end -}}

        {{- $description := .ExtractContent "(?i)\\x60\\x60\\x60commit-message(?P<content>[\\\\w|\\\\W]+?)\\x60\\x60\\x60" $body -}}
        {{- if $description -}}{{- "\\n\\n" -}}{{- end -}}
        {{- $description -}}

        {{- $signedAuthors := .GitHub.NormalizeSignedOffBy -}}
        {{- if $signedAuthors -}}{{- "\\n\\n" -}}{{- end -}}
        {{- range $index, $author := $signedAuthors -}}
          {{- if $index -}}{{- "\\n" -}}{{- end -}}
          {{- "Signed-off-by:" }} {{ .Name }} <{{- .Email -}}>
        {{- end -}}

        {{- $coAuthors := .GitHub.NormalizeCoAuthorBy -}}
        {{- if $coAuthors -}}{{- "\\n\\n" -}}{{- end -}}
        {{- range $index, $author := $coAuthors -}}
          {{- if $index -}}{{- "\\n" -}}{{- end -}}
          {{- "Co-authored-by:" }} {{ .Name }} <{{- .Email -}}>
        {{- end -}}
    pingcap/tidb:
      title: >-
        {{ .ExtractContent
        "^(?P<content>.+?)(\\\\s+\\\\|(\\\\s+[-\\\\w]+=[-.\\\\w/]+)+)?\\\\s*$" .Title
        }} (#{{ .Number }})
      body: |
        {{- $body := print .Body -}}
        {{- $issueNumberLine := .ExtractContent "(?im)^Issue Number:.+" $body -}}
        {{- $numbers := .GitHub.NormalizeIssueNumbers $issueNumberLine -}}
        {{- if $numbers -}}
          {{- range $index, $number := $numbers -}}
            {{- if $index }}, {{ end -}}
            {{- .AssociatePrefix }} {{ .Org -}}/{{- .Repo -}}#{{- .Number -}}
          {{- end -}}
        {{- else -}}
          {{- " " -}}
        {{- end -}}
    pingcap/tidb-tools:
      title: "{{ .Title }} (#{{ .Number }})"
      body: |
        {{- $body := print .Body -}}
        {{- $issueNumberLine := .ExtractContent "(?im)^Issue Number:.+" $body -}}
        {{- $numbers := .GitHub.NormalizeIssueNumbers $issueNumberLine -}}
        {{- if $numbers -}}
          {{- range $index, $number := $numbers -}}
            {{- if $index }}, {{ end -}}
            {{- .AssociatePrefix }} {{ .Org -}}/{{- .Repo -}}#{{- .Number -}}
          {{- end -}}
        {{- else -}}
          {{- " " -}}
        {{- end -}}
    pingcap/tiflow:
      title: "{{ .Title }} (#{{ .Number }})"
      body: |
        {{- $body := print .Body -}}
        {{- $issueNumberLine := .ExtractContent "(?im)^Issue Number:.+" $body -}}
        {{- $numbers := .GitHub.NormalizeIssueNumbers $issueNumberLine -}}
        {{- if $numbers -}}
          {{- range $index, $number := $numbers -}}
            {{- if $index }}, {{ end -}}
            {{- .AssociatePrefix }} {{ .Org -}}/{{- .Repo -}}#{{- .Number -}}
          {{- end -}}
        {{- else -}}
          {{- " " -}}
        {{- end -}}
    pingcap/tidb-binlog:
      title: "{{ .Title }} (#{{ .Number }})"
      body: |
        {{- $body := print .Body -}}
        {{- $issueNumberLine := .ExtractContent "(?im)^Issue Number:.+" $body -}}
        {{- $numbers := .GitHub.NormalizeIssueNumbers $issueNumberLine -}}
        {{- if $numbers -}}
          {{- range $index, $number := $numbers -}}
            {{- if $index }}, {{ end -}}
            {{- .AssociatePrefix }} {{ .Org -}}/{{- .Repo -}}#{{- .Number -}}
          {{- end -}}
        {{- else -}}
          {{- " " -}}
        {{- end -}}
    pingcap/ng-monitoring:
      title: "{{ .Title }} (#{{ .Number }})"
      body: |
        {{- $body := print .Body -}}
        {{- $issueNumberLine := .ExtractContent "(?im)^Issue Number:.+" $body -}}
        {{- $numbers := .GitHub.NormalizeIssueNumbers $issueNumberLine -}}
        {{- if $numbers -}}
          {{- range $index, $number := $numbers -}}
            {{- if $index }}, {{ end -}}
            {{- .AssociatePrefix }} {{ .Org -}}/{{- .Repo -}}#{{- .Number -}}
          {{- end -}}
        {{- else -}}
          {{- " " -}}
        {{- end -}}
    pingcap/community:
      title: "{{ .Title }} (#{{ .Number }})"
      body: " "
    pingcap/tidb-dashboard:
      title: "{{ .Title }} (#{{ .Number }})"
      body: " "
    pingcap/tidb-operator:
      title: "{{ .Title }} (#{{ .Number }})"
      body: " "
    pingcap/tiup:
      title: "{{ .Title }} (#{{ .Number }})"
      body: " "
    pingcap/docs:
      title: "{{ .Title }} (#{{ .Number }})"
      body: " "
    pingcap/docs-cn:
      title: "{{ .Title }} (#{{ .Number }})"
      body: " "
    pingcap/docs-tidb-operator:
      title: "{{ .Title }} (#{{ .Number }})"
      body: " "
    pingcap/tiflash: &mct_tiflash
      title: "{{ .Title }} (#{{ .Number }})"
      body: |
        {{- $body := print .Body -}}
        {{- $issueNumberLine := .ExtractContent "(?im)^Issue Number:.+" $body -}}
        {{- $numbers := .GitHub.NormalizeIssueNumbers $issueNumberLine -}}
        {{- if $numbers -}}
          {{- range $index, $number := $numbers -}}
            {{- if $index }}, {{ end -}}
            {{- .AssociatePrefix }} {{ .Org -}}/{{- .Repo -}}#{{- .Number -}}
          {{- end -}}
        {{- else -}}
          {{- " " -}}
        {{- end -}}

        {{- $description := .ExtractContent "(?i)\\x60\\x60\\x60commit-message(?P<content>[\\\\w|\\\\W]+?)\\x60\\x60\\x60" $body -}}
        {{- if $description -}}{{- "\\n\\n" -}}{{- end -}}
        {{- $description -}}

        {{- $signedAuthors := .GitHub.NormalizeSignedOffBy -}}
        {{- if $signedAuthors -}}{{- "\\n\\n" -}}{{- end -}}
        {{- range $index, $author := $signedAuthors -}}
          {{- if $index -}}{{- "\\n" -}}{{- end -}}
          {{- "Signed-off-by:" }} {{ .Name }} <{{- .Email -}}>
        {{- end -}}

        {{- $coAuthors := .GitHub.NormalizeCoAuthorBy -}}
        {{- if $coAuthors -}}{{- "\\n\\n" -}}{{- end -}}
        {{- range $index, $author := $coAuthors -}}
          {{- if $index -}}{{- "\\n" -}}{{- end -}}
          {{- "Co-authored-by:" }} {{ .Name }} <{{- .Email -}}>
        {{- end -}}
    pingcap/tidb-engine-ext: *mct_tiflash
    pingcap/tispark:
      title: "{{ .Title }} (#{{ .Number }})"
      body: " "
    pingcap/tiunimanager:
      title: "{{ .Title }} (#{{ .Number }})"
      body: " "
    pingcap/tiunimanager-ui:
      title: "{{ .Title }} (#{{ .Number }})"
      body: " "
    pingcap-inc/tiflash-scripts:
      title: "{{ .Title }} (#{{ .Number }})"
      body: " "

  target_url: https://prow.tidb.net/tide

  pr_status_base_urls:
    "*": https://prow.tidb.net/pr

  squash_label: tide/merge-method-squash
  rebase_label: tide/merge-method-rebase
  merge_label: tide/merge-method-merge

  queries:
    # Notice: The following repository are included in version release management.
    # Notice: Because pingcap/tidb, tikv/tikv, tikv/pd repos enable the 'Require approvals' option on branch protection,
    #         we need to enable the 'reviewApprovedRequired' option on tide.
    - repos:
        - tikv/community
      includedBranches:
        - master
        - feature/ # feature branches.
      labels:
        - status/can-merge
      missingLabels:
        - do-not-merge/blocked-paths
        - do-not-merge/hold
        - do-not-merge/invalid-title
        - do-not-merge/needs-linked-issue
        - do-not-merge/needs-triage-completed
        - do-not-merge/release-note-label-needed
        - do-not-merge/work-in-progress
        - needs-rebase
      reviewApprovedRequired: true

    # Repos which migrated to lgtm + approve plugins
    - repos:
        - ti-community-infra/rfcs
        - ti-community-infra/test-prod
        - ti-community-infra/tichi
      labels:
        - lgtm
        - approved
      missingLabels:
        - "dco-signoff: no"
        - do-not-merge/blocked-paths
        - do-not-merge/hold
        - do-not-merge/invalid-title
        - do-not-merge/needs-linked-issue
        - do-not-merge/work-in-progress
        - needs-rebase

    - repos:
        - pingcap/docs
        - pingcap/docs-cn
        - pingcap/docs-tidb-operator
      # github query api index with `HasPrefix`.
      includedBranches:
        - master # trunk branch.
        - release-1. # release-1.2 ~ release-1.5 for docs-tidb-operator
        - release-4. # keep before EOL
        - release-5. # keep before EOL
        - release-6. # release-6.x, release-6.x.y-*
        - release-6.1 # LTS: avoid prow's "Merging to branch *** is forbidden" description issue.
        - release-6.5 # LTS: avoid prow's "Merging to branch *** is forbidden" description issue.
        - release-7.1 # LTS: avoid prow's "Merging to branch *** is forbidden" description issue.
        - release-7.5 # LTS: avoid prow's "Merging to branch *** is forbidden" description issue.
        - release-7. # release-7.x, release-7.x.y-*
        - release-8.1 # LTS: avoid prow's "Merging to branch *** is forbidden" description issue.
        - release-8. # release-8.x, release-8.x.y-*
        - release-8.3 # DMR: avoid prow's "Merging to branch *** is forbidden" description issue.
        # - release-{{.ver}}
      labels:
        - lgtm
        - approved
      missingLabels:
        - do-not-merge
        - do-not-merge/blocked-paths
        - do-not-merge/cherry-pick-not-approved
        - do-not-merge/contains-merge-commits
        - do-not-merge/hold
        - do-not-merge/invalid-commit-message
        - do-not-merge/invalid-owners-file
        - do-not-merge/invalid-title
        - do-not-merge/needs-linked-issue
        - do-not-merge/needs-triage-completed
        - do-not-merge/release-note-label-needed
        - do-not-merge/work-in-progress
        - needs-rebase

    - repos:
        - pingcap/community
        - pingcap/tiunimanager
        - pingcap/tiunimanager-ui
        - pingcap/tiup
        # github query api index with `HasPrefix`.
      includedBranches:
        - master # trunk branch.
        - feature/ # feature branches.
        - release-
      labels:
        - lgtm
        - approved
      missingLabels:
        - do-not-merge
        - do-not-merge/blocked-paths
        - do-not-merge/cherry-pick-not-approved
        - do-not-merge/contains-merge-commits
        - do-not-merge/hold
        - do-not-merge/invalid-commit-message
        - do-not-merge/invalid-owners-file
        - do-not-merge/invalid-title
        - do-not-merge/needs-linked-issue
        - do-not-merge/needs-triage-completed
        - do-not-merge/release-note-label-needed
        - do-not-merge/work-in-progress
        - needs-rebase

    - repos:
        - pingcap-inc/enterprise-extensions
        - pingcap-inc/enterprise-plugin
        - pingcap-inc/tiflash-scripts
        - pingcap/kvproto
        - pingcap/monitoring
        - pingcap/ng-monitoring
        - pingcap/tidb
        - pingcap/tidb-binlog
        - pingcap/tidb-dashboard
        - pingcap/tidb-operator
        - pingcap/tidb-tools
        - pingcap/tiflash
        - pingcap/tiflow
        - pingcap/tispark
        - tikv/pd
        - tikv/tikv
      includedBranches: # github query api index with `HasPrefix`.
        - main # trunk branch.
        - master # trunk branch.
        - feature/ # feature branches.
        - release-5.4
        - release-6.1 # LTS: avoid prow's "Merging to branch *** is forbidden" description issue.
        - release-6.5 # LTS: avoid prow's "Merging to branch *** is forbidden" description issue.
        - release-6. # release-6.x.y, release-6.x.y-*
        - release-7.1 # LTS: avoid prow's "Merging to branch *** is forbidden" description issue.
        - release-7.5 # LTS: avoid prow's "Merging to branch *** is forbidden" description issue.
        - release-7. # release-7.x, release-7.x.y-*
        - release-8.1 # LTS: avoid prow's "Merging to branch *** is forbidden" description issue.
        - release-8. # release-8.x, release-8.x.y-*
        - release-8.3 # DMR: avoid prow's "Merging to branch *** is forbidden" description issue.
        # - release-{{.ver}}
      labels:
        - lgtm
        - approved
      missingLabels:
        - do-not-merge
        - do-not-merge/blocked-paths
        - do-not-merge/cherry-pick-not-approved
        - do-not-merge/contains-merge-commits
        - do-not-merge/hold
        - do-not-merge/invalid-commit-message
        - do-not-merge/invalid-owners-file
        - do-not-merge/invalid-title
        - do-not-merge/needs-linked-issue
        - do-not-merge/needs-tests-checked
        - do-not-merge/needs-triage-completed
        - do-not-merge/release-note-label-needed
        - do-not-merge/work-in-progress
        - needs-rebase

    - repos:
        - pingcap/tidb-engine-ext
        - pingcap/tiproxy
        - tikv/client-go
        - tikv/client-rust
        - tikv/raft-engine
        - tikv/rocksdb
        - tikv/rust-rocksdb
      labels:
        - lgtm
        - approved
      missingLabels:
        - do-not-merge
        - do-not-merge/blocked-paths
        - do-not-merge/cherry-pick-not-approved
        - do-not-merge/contains-merge-commits
        - do-not-merge/hold
        - do-not-merge/invalid-commit-message
        - do-not-merge/invalid-owners-file
        - do-not-merge/invalid-title
        - do-not-merge/needs-linked-issue
        - do-not-merge/needs-triage-completed
        - do-not-merge/release-note-label-needed
        - do-not-merge/work-in-progress
        - needs-rebase

    - repos:
        - PingCAP-QE/tidb-test
        # github query api index with `HasPrefix`.
      excludedBranches:
        # patched release branches.
        - release-6.1.
        - release-6.5.
        - release-7.1.
        - release-7.5.
        - release-8.1.
        # - release-{{.ver}}. # just for LTS.
      labels:
        - lgtm
        - approved
      missingLabels:
        - do-not-merge
        - do-not-merge/blocked-paths
        - do-not-merge/cherry-pick-not-approved
        - do-not-merge/contains-merge-commits
        - do-not-merge/hold
        - do-not-merge/invalid-commit-message
        - do-not-merge/invalid-owners-file
        - do-not-merge/invalid-title
        - do-not-merge/needs-linked-issue
        - do-not-merge/needs-triage-completed
        - do-not-merge/release-note-label-needed
        - do-not-merge/work-in-progress
        - needs-rebase

    - repos:
        - PingCAP-QE/automated-tests
        - PingCAP-QE/benchbot
        - PingCAP-QE/ci
        - PingCAP-QE/endless
        - PingCAP-QE/qa
        - PingCAP-QE/test-infra
        - PingCAP-QE/test-plan
        - PingCAP-QE/workload
        - ti-community-infra/configs
      labels:
        - lgtm
        - approved
      missingLabels:
        - do-not-merge
        - do-not-merge/blocked-paths
        - do-not-merge/contains-merge-commits
        - do-not-merge/hold
        - do-not-merge/invalid-commit-message
        - do-not-merge/invalid-owners-file
        - do-not-merge/work-in-progress
        - needs-rebase
    - repos:
        - PingCAP-QE/artifacts
        - PingCAP-QE/ee-ops
        - PingCAP-QE/ee-apps
      labels:
        - approved
      missingLabels:
        - do-not-merge
        - do-not-merge/blocked-paths
        - do-not-merge/contains-merge-commits
        - do-not-merge/hold
        - do-not-merge/invalid-commit-message
        - do-not-merge/invalid-owners-file
        - do-not-merge/work-in-progress
        - needs-rebase

  context_options:
    orgs:
      ti-community-infra:
        skip-unknown-contexts: true
        from-branch-protection: true
        repos: {}
      tikv:
        repos:
          pd:
            required-contexts:
              - "dco"
              - "idc-jenkins-ci/build"
            skip-unknown-contexts: true
            branches:
              master: &pd-branch-tide-context-options
                required-contexts:
                  - "statics"
                  - "chunks (1, Unit Test(1))"
                  - "chunks (2, Unit Test(2))"
                  - "chunks (3, Unit Test(3))"
                  - "chunks (4, Tests(1))"
                  - "chunks (5, Tests(2))"
                  - "chunks (6, Tools Test)"
                  - "chunks (7, Client Integration Test)"
                  - "chunks (8, TSO Integration Test)"
                  - "chunks (9, MicroService Integration(!TSO))"
                  - "chunks (10, MicroService Integration(TSO))"
                  - "tso-function-test"
                skip-unknown-contexts: true
              release-5.4:
                required-contexts:
                  - "statics"
                  - "tso-function-test"
                  - "idc-jenkins-ci/test"
                skip-unknown-contexts: true
              release-6.0:  &pd-branch-tide-context-options-old
                required-contexts:
                  - "statics"
                  - "chunks (1)"
                  - "chunks (2)"
                  - "chunks (3)"
                  - "chunks (4)"
                  - "chunks (5)"
                  - "chunks (6)"
                  - "chunks (7)"
                  - "chunks (8)"
                  - "chunks (9)"
                  - "chunks (10)"
                  - "tso-function-test"
                skip-unknown-contexts: true
              release-6.1: *pd-branch-tide-context-options-old
              release-6.2: *pd-branch-tide-context-options-old
              release-6.3: *pd-branch-tide-context-options-old
              release-6.4: *pd-branch-tide-context-options-old
              release-6.5: *pd-branch-tide-context-options-old
              release-6.6: *pd-branch-tide-context-options-old
              release-7.0: *pd-branch-tide-context-options-old
              release-7.1: *pd-branch-tide-context-options-old
              release-7.2: *pd-branch-tide-context-options-old
              release-7.3: *pd-branch-tide-context-options-old
              release-7.4: *pd-branch-tide-context-options-old
              release-7.5: *pd-branch-tide-context-options-old
              release-8.0: *pd-branch-tide-context-options-old
              release-8.1: *pd-branch-tide-context-options-old
              release-8.2: *pd-branch-tide-context-options
              release-8.3: *pd-branch-tide-context-options
              # release-{{.ver}}: *pd-branch-tide-context-options

          tikv:
            from-branch-protection: true
            skip-unknown-contexts: true

      pingcap:
        repos:
          tidb-dashboard:
            from-branch-protection: true
            skip-unknown-contexts: true
          tidb-operator:
            from-branch-protection: true
            skip-unknown-contexts: true
          tiup:
            from-branch-protection: true
            skip-unknown-contexts: false
          docs:
            skip-unknown-contexts: true
            from-branch-protection: true
          docs-cn:
            skip-unknown-contexts: true
            from-branch-protection: true
          docs-tidb-operator:
            skip-unknown-contexts: true
            from-branch-protection: true
          tidb-tools:
            skip-unknown-contexts: true
            from-branch-protection: true
          tiflow:
            skip-unknown-contexts: true
            from-branch-protection: true
          tidb-binlog:
            skip-unknown-contexts: true
            from-branch-protection: true
          tiflash:
            skip-unknown-contexts: true
            from-branch-protection: true
          tidb:
            skip-unknown-contexts: true
            from-branch-protection: true
          ng-monitoring:
            skip-unknown-contexts: true
            from-branch-protection: true
          tispark:
            skip-unknown-contexts: true
            from-branch-protection: true
          tiunimanager:
            skip-unknown-contexts: true
            from-branch-protection: true
          tiunimanager-ui:
            skip-unknown-contexts: true
            from-branch-protection: true
          tidb-engine-ext:
            skip-unknown-contexts: true
            from-branch-protection: true
      pingcap-inc:
        repos:
          tiflash-scripts:
            skip-unknown-contexts: true
            from-branch-protection: true
